<!DOCTYPE html>
<html>
<head>
<style>
table, th, td{

}

table, th, td {
  border-collapse: collapse;
  border: 1px solid black;
}

table td {  
    font-weight: bold;
    text-align: center;
    table-layout:inherit;
    display: inline-block;
    width: 40px;
    height: 40px;
    font-size: 27px;
    text-align: center;
    vertical-align: middle;
}

.one {
    color: blue;
}
.two {
    color: green;
}
.three {
    color: red;
}
.four {
    color: purple;
}
.five {
    color: maroon;
}
.six {
    color: turquoise;
}
.seven {
    color: black;
}
.eight {
    color: gray;
}

.zero {
}
.flagCount {
 font-size: 30px;
}

.block {
  width: 100%;
  height: 100%;
  border: none;
  background-color: #ddd;
}

.block:hover {
  background-color: #eee;
}

.flag{
  display: block;
  max-width: 100%;
  height: auto;
  border: 1px;  
}

.bomb{
  width:100%;
  height:100%; 
}
.rules {
  border: 5px dashed red;
  color:blue;
}

</style>

</head>
<body id = "body">
  <br>
<button onclick="easyMode()">Easy</button>
<button onclick="mediumMode()">Medium</button>
<button onclick="hardMode()">Hard</button>&nbsp&nbsp
<img src="images/flag.webp"  height="30" width="30"><label class="flagCount" id="flagCounter"></label>
<div>&nbsp</div>
<table id="myTable">
</table>
<h1 class = "rules">Rules</h1>
<p class = "rules">Instructions for MineSweeper:<br>

You are presented with a board of squares. Some squares contain mines (bombs), others don't. If you click on a square containing a bomb, you lose. If you manage to click all the squares (without clicking on any bombs) you win.<br>
Clicking a square which doesn't have a bomb reveals the number of neighbouring squares containing bombs. Use this information to avoid the bombs.<br>
To open a square, point at the square and click on it. To mark a square you think is a bomb, point and right-click.<br></p>

<p class="rules">Detailed Instructions:<br>

A squares "neighbours" are the squares adjacent above, below, left, right, and all 4 diagonals. Squares on the sides of the board or in a corner have fewer neighbors. The board does not wrap around the edges.<br>
If you open a square with 0 neighboring bombs, all its neighbors will automatically open. This can cause a large area to automatically open.
To remove a bomb marker from a square, point at it and right-click again.<br>
If you mark a bomb incorrectly, you will have to correct the mistake before you can win. Incorrect bomb marking doesn't kill you, but it can lead to mistakes which do.<br>
You don't have to mark all the bombs to win; you just need to open all non-bomb squares.<br>
</p>


</body>
</html>
<script type="text/javascript">

var n = 8;
var bombCount = 10;
var bombs;
var flags;
var flagCount;

//start with easy mode
easyMode();

function easyMode() {
  n = 8;
  bombCount = 8;
  initialize(n, bombCount);
}

function mediumMode() {
  n = 14;
  bombCount = 25;
  initialize(n, bombCount);
}

function hardMode() {
  n = 20;
  bombCount = 60;
  initialize(n, bombCount);
}

function initialize(n, bombCount)
{
  var table = document.getElementById("myTable");
  table.innerHTML = "";
  bombs = new Array(n).fill(0).map(() => new Array(n).fill(0));
  flags = new Array(n).fill(0).map(() => new Array(n).fill(0));
  for (var i = 0; i < n; i++) 
  {
    var tableRow = document.createElement("tr");
    tableRow.setAttribute("id", i);
    for (var j = 0; j < n; j++) 
    {
      var tableData = document.createElement("td");
      tableData.setAttribute("id", i+"."+j);
      tableData.innerHTML ='<button type="button" class="block" onclick="cellClicked('+i+','+j+')" oncontextmenu="cellRightClicked('+i+','+j+'); return false;" id = "b'+ i +'.'+ j +'" ></button>';
      tableRow.appendChild(tableData);
    }
    myTable.appendChild(tableRow);
  }

  initializeBombs(bombs, n, n, bombCount);
  flagCount = getFlagCount();
  updateFlagCount(flagCount);

}
function getFlagCount() {
  var flags = 0;
  for (var i = 0; i < n; i++) 
  {
      for (var j = 0; j < n; j++) 
      {
          if (bombs[i][j] == 1) 
          {
            flags++;
          }; 
      };
  };
  return flags;
};

function updateFlagCount (flagCount) {
  var flagCounter =  document.getElementById("flagCounter");
  flagCounter.innerHTML = flagCount;
}

function showNumber (row, column, number) {
    var cell = document.getElementById(row + "." + column);
    var wordForm;

    if (number == 1) {
      wordForm = "one";
    } else if (number == 2) {
        wordForm = "two";
      }
      else if (number == 3) {
        wordForm = "three";
      }
      else if (number == 4) {
        wordForm = "four";
      }
      else if (number == 5) {
        wordForm = "five";
      }
      else if (number == 6) {
        wordForm = "six";
      }
      else if (number == 7) {
        wordForm = "seven";
      }
      else if (number == 8) {
        wordForm = "eight";
      }
      
      if (number >= 1) {
        cell.innerHTML = "<div class = " + wordForm + ">" + number + "</div>";
      } else {
        cell.innerHTML = "<div class = 'zero' > </div>";
      };
      

};
function initializeBombs (bombs, rows, columns, bombCount) {
   //remember to exclude squares that already have bombs
   var bombRow;
   var bombColumn;
   console.log(bombs);
  for (var i = 0; i < bombCount; i++) {
    bombRow = Math.floor(Math.random() * n);
    bombColumn = Math.floor(Math.random() * n);
    bombs[bombRow][bombColumn] = 1;
    console.log(bombRow + " " + bombColumn + "\n");
    console.log(bombs);
  }
    console.log(bombs);
};

function cellClicked (row, column) {
    var i, j, k, l;
    //debugger
    if (flags[row][column] == 1) {
      return;
    };

    if (bombs[row][column] == 1) 
    {
      displayBombs(bombs, n, n);
      alert("You Lose!");
    } 
    else 
    {
      var bombCount = 0;

      for (i = row - 1; i <= row + 1 && i < n; i++) 
      {
        if (i >= 0) 
        {
          for (j = column - 1; j <= column + 1 && j < n; j++) 
          {
            if (j >= 0) 
            {
              if (bombs[i][j] == 1) 
              {
                bombCount++;
                
              };
            }; 
          };
        };
      };
      showNumber(row, column, bombCount);
      bombs[row][column] = 2;

      if (bombCount == 0) 
      {
        for (k = row - 1; k <= row + 1 && k < n; k++) 
        {
          if (k >= 0 ) {
            for (l = column - 1; l <= column + 1 && l < n; l++) 
            {
              if (l >= 0 )
              {
                if(bombs[k][l] == 0)
                  cellClicked(k, l);
              };
            };  
          };  
        };
      };
    };
      var gameStatus = isGameOver(bombs);
      if (gameStatus == true) 
      {
        alert("YOU WIN!!");
      };   
};
function cellRightClicked (row, column) 
{
  debugger
  var button =  document.getElementById("b"+ row +'.'+ column);
  if (flags[row][column] == 0) 
  {//if there is not a flag already in the cell that was clicked then show a flag
    button.innerHTML = "<img class='flag' src='images/flag.webp'>";
    flags[row][column] = 1;
    flagCount--;
    updateFlagCount(flagCount);
  } 
  else 
  {//else remove the flag from that cell
    button.innerHTML = "";
    flags[row][column] = 0;
    flagCount++;
    updateFlagCount(flagCount);
  };

};

function isGameOver (grid) 
{
  for (var i = 0; i < n; i++) 
  {
      for (var j = 0; j < n; j++) 
      {
          if (grid[i][j] == 0) 
          {
            return false;

          }; 
      };
  };
  return true;
};
  
function displayBombs (bombs, rows, columns) {
  console.log(bombs);
for (var i = 0; i < rows; i++) {
  for (var j = 0; j < columns; j++) {
    if (bombs[i][j] == 1) {
      showBomb(i, j);
    
    };
  }
}

function showBomb (row, column) {
    var bomb = document.getElementById(row + "." + column);
    bomb.innerHTML = "<img class='bomb' src='images/bomb.png'>";
};

};

</script>
